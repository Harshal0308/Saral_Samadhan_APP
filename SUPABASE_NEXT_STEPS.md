# SARAL App - Supabase Setup: Next Steps

## ğŸ¯ Current Status

âœ… Teachers table already exists in Supabase
âœ… You've started the setup process

---

## ğŸ“‹ What to Do Now

### Step 1: Check Existing Tables (5 minutes)

```
1. Go to Supabase Dashboard
2. Click "Table Editor"
3. Check which tables exist:
   âœ… teachers (already exists)
   â“ students (check)
   â“ attendance_records (check)
   â“ volunteer_reports (check)
   â“ centers (check)
```

### Step 2: Create Missing Tables (10 minutes)

Follow the guide: **SUPABASE_EXISTING_TABLES.md**

```
1. For each missing table:
   - Go to SQL Editor
   - Copy the CREATE TABLE query
   - Paste and run
   - Verify table appears in Table Editor
```

### Step 3: Enable RLS (10 minutes)

```
1. For each table:
   - Click table name
   - Toggle RLS ON (blue)
   - Create policies using SQL queries
```

### Step 4: Create Teacher Accounts (10 minutes)

```
1. Go to Authentication â†’ Users
2. Add users:
   - teacher1@saral.com
   - teacher2@saral.com
   - teacher3@saral.com
   - admin@saral.com
3. Copy UUIDs
4. Insert into teachers table
```

### Step 5: Update App (5 minutes)

```
1. Get Supabase credentials:
   - Project URL
   - Anon key
2. Update lib/main.dart
3. Run app: flutter run
```

### Step 6: Test (10 minutes)

```
1. Login as teacher1
2. Add student
3. Logout
4. Login as teacher2
5. Click sync
6. Verify student appears
```

---

## ğŸš€ Quick Start (30 minutes total)

### If You're in a Hurry

```
1. Open SUPABASE_EXISTING_TABLES.md
2. Follow sections:
   - Step 2: Create Missing Tables
   - Step 3: Enable RLS
   - Step 4: Create Teacher Accounts
   - Step 5: Update App
3. Test multi-teacher login
4. Done! âœ…
```

---

## ğŸ“Š Complete Checklist

### Tables
- [ ] teachers table exists
- [ ] students table created
- [ ] attendance_records table created
- [ ] volunteer_reports table created
- [ ] centers table created

### RLS
- [ ] RLS enabled on teachers
- [ ] RLS enabled on students
- [ ] RLS enabled on attendance_records
- [ ] RLS enabled on volunteer_reports
- [ ] Policies created for all tables

### Teachers
- [ ] Auth users created (4 users)
- [ ] Teacher records inserted
- [ ] UUIDs match between auth and database

### App
- [ ] Supabase URL updated
- [ ] Supabase anon key updated
- [ ] App compiles
- [ ] Multi-teacher login works
- [ ] Data sync works

---

## ğŸ“ Understanding the Setup

### Why These Tables?

```
teachers
â”œâ”€â”€ Stores teacher info
â”œâ”€â”€ Links to auth users
â””â”€â”€ Determines center access

students
â”œâ”€â”€ Stores student data
â”œâ”€â”€ Filtered by center
â””â”€â”€ Shared between teachers

attendance_records
â”œâ”€â”€ Stores attendance
â”œâ”€â”€ Filtered by center
â””â”€â”€ Shared between teachers

volunteer_reports
â”œâ”€â”€ Stores volunteer data
â”œâ”€â”€ Filtered by center
â””â”€â”€ Shared between teachers

centers
â”œâ”€â”€ Stores center info
â””â”€â”€ Reference data
```

### How RLS Works

```
Teacher 1 (Mumbai Central)
  â†“
RLS Policy: "Show only Mumbai Central data"
  â†“
Sees: Students, attendance, reports from Mumbai Central
Doesn't see: Data from Pune, Nashik, etc.

Teacher 2 (Mumbai Central)
  â†“
RLS Policy: "Show only Mumbai Central data"
  â†“
Sees: Same data as Teacher 1
Doesn't see: Data from other centers
```

### How Sync Works

```
Teacher 1 adds student
  â†“
Saved to local database
  â†“
If online â†’ Uploaded to Supabase
  â†“
Teacher 2 clicks sync
  â†“
Downloads from Supabase
  â†“
Sees same student
```

---

## ğŸ”‘ Key Concepts

### UUID (User ID)

```
- Unique identifier for each user
- Generated by Supabase auth
- Must match between auth and database
- Example: 550e8400-e29b-41d4-a716-446655440000
```

### Center Name

```
- Determines data access
- Teachers only see their center's data
- Must match exactly (case-sensitive)
- Examples: "Mumbai Central", "Pune East Center"
```

### RLS Policy

```
- Security rule for database access
- Checks: Is this user allowed to see this data?
- Example: "Show students only from user's center"
```

---

## ğŸ†˜ Common Issues & Solutions

### Issue: "Relation already exists"

```
Cause: Table already created
Solution: Skip that CREATE TABLE step
Use: CREATE TABLE IF NOT EXISTS instead
```

### Issue: "Permission denied"

```
Cause: RLS policy blocking access
Solution: 
1. Check RLS is enabled
2. Check policies are created
3. Check UUID matches
4. Check center_name matches
```

### Issue: "Data not syncing"

```
Cause: Multiple possible reasons
Solution:
1. Check internet connection
2. Check RLS policies
3. Check cloud_sync_service is called
4. Check logs for errors
```

### Issue: "Can't login"

```
Cause: Auth user not created or wrong credentials
Solution:
1. Check user exists in Authentication
2. Check email is correct
3. Check password is correct
4. Check user is active
```

---

## ğŸ“ Getting Help

### Documentation Files

```
SUPABASE_SETUP_GUIDE.md
â”œâ”€â”€ Complete step-by-step guide
â”œâ”€â”€ All SQL queries
â””â”€â”€ Detailed explanations

SUPABASE_EXISTING_TABLES.md
â”œâ”€â”€ For existing tables
â”œâ”€â”€ Create missing tables
â””â”€â”€ Enable RLS

MULTI_TEACHER_SETUP.md
â”œâ”€â”€ How multi-teacher works
â”œâ”€â”€ Best practices
â””â”€â”€ Troubleshooting
```

### Supabase Resources

```
https://supabase.com/docs
https://supabase.com/docs/guides/auth
https://supabase.com/docs/guides/database
https://supabase.com/docs/guides/realtime
```

---

## âœ… Success Criteria

### You'll Know It's Working When:

```
âœ… Multiple teachers can login
âœ… Each teacher sees their center's data
âœ… Teachers in same center see same data
âœ… Teachers in different centers see different data
âœ… Data syncs between teachers
âœ… Offline mode works
âœ… No permission errors
âœ… No data conflicts
```

---

## ğŸ¯ Timeline

### Estimated Time: 1-2 hours

```
Step 1: Check tables (5 min)
Step 2: Create missing tables (10 min)
Step 3: Enable RLS (10 min)
Step 4: Create teachers (10 min)
Step 5: Update app (5 min)
Step 6: Test (10 min)
Buffer: 15 min
Total: ~1 hour
```

---

## ğŸš€ Ready to Start?

### Follow This Order:

1. **Read**: SUPABASE_EXISTING_TABLES.md
2. **Do**: Create missing tables
3. **Do**: Enable RLS
4. **Do**: Create teacher accounts
5. **Do**: Update app credentials
6. **Test**: Multi-teacher login
7. **Celebrate**: It works! ğŸ‰

---

## ğŸ“ Notes

- Save your Supabase credentials somewhere safe
- Don't share your anon key publicly
- Test with multiple teachers before publishing
- Monitor logs for errors
- Keep backups of your database

---

## ğŸ‰ You're Almost There!

The hard part is done. Now just follow the steps in SUPABASE_EXISTING_TABLES.md and you'll have multi-teacher support working!

**Questions? Check the troubleshooting section or review the documentation files.**

**Ready? Let's go! ğŸš€**
